# Монитор безопасности
Схема работы монитора безопасности
![](../docs/images/Схема%20монитора.png)

Описание работы монитора:

Монитору известны публичные ключи всех процессов.

Когда процесс хочет обратиться к другому процессу, он записывает сообщение в формате JSON в топик monitor. При этом он обязательно подписывает его своим приватным ключом.

Монитор слушает топик monitor, при получении нового сообщения, он отправляет задачу в rabbitmq с этим сообщением. Это необходимо для возможности масштабирования.

Воркеры dramatiq выполняют следующие валидации:
1. Получили валидный JSON
2. Источник существует
3. Тело запроса передано от источника (проверка подписи)
4. Получатель существует
5. Разрешена пересылка сообщений от источника к получателю
6. Тип сообщения существует
7. Проверка корректности тела сообщения

Если хотя бы одна из этих валидаций не проходит, то воркер пишет warning лог в elk и отклоняет такое сообщение. 

Если же все этапы успешно пройдены, то сообщение кладется в топик, который слушает процесс назначения